{"ast":null,"code":"import { io } from 'socket.io-client';\nimport { Observable, Subject } from 'rxjs';\nimport { environment } from '../environments/environment';\nimport * as i0 from \"@angular/core\";\nclass SocketWrapper {\n  constructor(socket) {\n    this.socket = socket;\n  }\n  fromEvent(eventName) {\n    return new Observable(subscriber => {\n      const handler = data => subscriber.next(data);\n      this.socket.on(eventName, handler);\n      return () => this.socket.off(eventName, handler);\n    });\n  }\n  emit(eventName, data) {\n    this.socket.emit(eventName, data);\n  }\n}\nexport let SocketService = /*#__PURE__*/(() => {\n  class SocketService {\n    constructor() {\n      this.isBeingReset = false;\n      this.systemMessage = new Subject();\n      this.typingMap = {};\n      this.conversations = {};\n      this.minimizedMap = {};\n      this.minimizeCommentsMap = {};\n      const socketUrl = environment.socketUrl || window.location.origin;\n      const client = io(socketUrl);\n      this.socket = new SocketWrapper(client);\n      this.goToInstance = this.socket.fromEvent('goToInstance');\n      this.socket.fromEvent('console').subscribe(console.log);\n      this.socket.fromEvent('instance').subscribe(instance => this.instance = instance);\n      this.socket.fromEvent('set-name').subscribe(name => {\n        this.name = name;\n        if (this.isBeingReset) {\n          this.isBeingReset = false;\n          if (!['delete', 'delete-all', 'delete-instance'].includes(this.lastAction.action)) {\n            this.socket.emit(this.lastAction.action, this.lastAction.data);\n          } else {\n            this.systemMessage.next('WOOPS! Looks like you got out of sync with the server. ' + 'You have been auto reconnected but deleting is forbidden from this state, ' + 'please try again.');\n          }\n        }\n      });\n      this.socket.fromEvent('reset').subscribe(_ => {\n        this.isBeingReset = true;\n        this.socket.emit('join', {\n          name: this.name,\n          instanceId: this.instance.title\n        });\n      });\n      setInterval(() => this.emit('ping', 'stay alive'), 60000);\n      this.socket.fromEvent('chat').subscribe(message => {\n        if (!this.conversations[message.name]) {\n          this.conversations[message.name] = [];\n        }\n        this.conversations[message.name].unshift(message);\n      });\n      this.socket.fromEvent('typing-start').subscribe(name => this.typingMap[name] = true);\n      this.socket.fromEvent('typing-stop').subscribe(name => this.typingMap[name] = false);\n    }\n    get offlineUsers() {\n      return Object.keys(this.instance.votes).filter(user => this.instance.users.indexOf(user) < 0);\n    }\n    minimize(id) {\n      this.minimizedMap[id] = !this.minimizedMap[id];\n    }\n    minimizeComments(id) {\n      this.minimizeCommentsMap[id] = !this.minimizeCommentsMap[id];\n    }\n    startTyping(to) {\n      this.socket.emit('typing-start', to);\n    }\n    stopTyping(to) {\n      this.socket.emit('typing-stop', to);\n    }\n    sendMessage(text, to) {\n      const message = {\n        name: this.name,\n        message: text\n      };\n      this.conversations[to].unshift(message);\n      this.socket.emit('chat', {\n        message,\n        to\n      });\n    }\n    startInstance(title, votesAllowed, negativeVotesAllowed, owner, emojiAllowed, columns) {\n      this.socket.emit('start', {\n        title,\n        votesAllowed,\n        negativeVotesAllowed,\n        owner,\n        emojiAllowed,\n        columns\n      });\n    }\n    emit(action, data) {\n      this.lastAction = {\n        action,\n        data\n      };\n      this.socket.emit(action, data);\n    }\n    get disabled() {\n      if (!this.instance) {\n        return true;\n      }\n      if (this.instance.owner === this.name) {\n        return false;\n      }\n      return this.instance.locked;\n    }\n    get votesLeft() {\n      if (!this.instance || !this.name) {\n        return 0;\n      }\n      return this.instance.votes[this.name];\n    }\n    static {\n      this.ɵfac = function SocketService_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || SocketService)();\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: SocketService,\n        factory: SocketService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return SocketService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}